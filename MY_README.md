# my_aider

Это форк проекта Aider с пользовательскими модификациями.

## Установка

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/VitalyKuzmin/my_aider.git
    cd my_aider
    ```

2.  **Создайте и активируйте виртуальное окружение:**
    *   **macOS/Linux:**
        ```bash
        python3 -m venv venv
        source venv/bin/activate
        ```
    *   **Windows:**
        ```bash
        python -m venv venv
        .\venv\Scripts\activate
        ```
    *(Используйте `python` или `python3` в зависимости от вашей системы)*

3.  **Установите пакет в режиме редактирования:**
    Этот шаг установит все необходимые зависимости (указанные в `pyproject.toml` или `setup.py`, которые должны включать `requirements.txt`) и сделает команду `aider` доступной *внутри активированного виртуального окружения*.
    ```bash
    pip install -e .
    ```
    *(Возможно, потребуется `pip3` вместо `pip`)*
    После этого шага вы можете запускать `my_aider` из командной строки, пока активно ваше виртуальное окружение (`source venv/bin/activate`).

## Глобальная установка с помощью pipx (Рекомендуется)

`pipx` — это инструмент для установки и запуска Python-приложений в изолированных окружениях. Это рекомендуемый способ сделать `my_aider` доступным глобально без конфликтов с другими пакетами.

**Важно:** Этот проект требует **Python 3.11**. Убедитесь, что Python 3.11 установлен в вашей системе. Вы можете установить его, например, с помощью Homebrew: `brew install python@3.11`.

1.  **Установите pipx** (если он еще не установлен):
    Следуйте [официальной инструкции по установке pipx](https://pipx.pypa.io/stable/installation/). Обычно это делается командой:
    ```bash
    python3 -m pip install --user pipx
    python3 -m pipx ensurepath
    ```
    *(Возможно, потребуется перезапустить терминал после `ensurepath`)*

2.  **Установите `my_aider` с помощью pipx, указав Python 3.11:**
    Эта команда установит последнюю версию из ветки `main` вашего репозитория `origin`, используя Python 3.11 для создания изолированного окружения. `pipx` добавит команду `my_aider` в ваш PATH.
    ```bash
    pipx install --python python3.11 git+https://github.com/VitalyKuzmin/my_aider.git
    ```
    *   Замените `python3.11` на точный путь к вашему исполняемому файлу Python 3.11, если он не находится в PATH как `python3.11`. Вы можете найти путь командой `which python3.11` (на macOS/Linux).
    *   **Примечание:** Если `pipx` сообщает, что пакет `my-aider-chat` уже установлен (`'my-aider-chat' already seems to be installed`), используйте флаг `--force` для принудительной переустановки/обновления:
        ```bash
        pipx install --force --python python3.11 git+https://github.com/VitalyKuzmin/my_aider.git
        ```

3.  **Обновление:**
    Для обновления до последней версии из репозитория:
    ```bash
    pipx upgrade my_aider
    ```

4.  **Удаление:**
    ```bash
    pipx uninstall my_aider
    ```

## Создание глобального доступа вручную (Альтернативный метод, macOS/Linux)

Если вы хотите запускать вашу модифицированную версию `aider` из любого места без необходимости каждый раз активировать виртуальное окружение (`source .venv/bin/activate`), вы можете создать символическую ссылку на исполняемый файл `aider` (или `my_aider`, в зависимости от того, как он называется в `.venv/bin`) из директории, которая уже есть в вашем системном `PATH`. Стандартное место для пользовательских скриптов в macOS/Linux - это `/usr/local/bin`.

1.  **Убедитесь, что `/usr/local/bin` существует и находится в вашем `PATH`:**
    *   Проверить `PATH`: `echo $PATH`
    *   Если `/usr/local/bin` нет, его может потребоваться создать (`sudo mkdir -p /usr/local/bin`) и добавить в `PATH` (обычно через конфигурационные файлы вашей оболочки, например, `~/.zshrc` или `~/.bash_profile`).

2.  **Найдите имя исполняемого файла:**
    Перейдите в корневую директорию вашего проекта `my_aider` и проверьте содержимое папки `.venv/bin`:
    ```bash
    ls .venv/bin
    ```
    Найдите исполняемый файл, который запускает вашу версию aider. После `pip install -e .` он должен называться `my_aider` (согласно `pyproject.toml`).

3.  **Создайте символическую ссылку:**
    Выполните эту команду из корневой директории вашего проекта `my_aider` (где находится папка `.venv`), используя имя `my_aider` для файла в `.venv/bin`:
    ```bash
    ln -s "$(pwd)/.venv/bin/my_aider" /usr/local/bin/my_aider
    ```
    *   `"$(pwd)/.venv/bin/my_aider"`: Получает полный путь к исполняемому файлу `my_aider` внутри вашего виртуального окружения.
    *   `/usr/local/bin/my_aider`: Создает ссылку с именем `my_aider` в `/usr/local/bin`.

    **Если вы получили ошибку `Permission denied`:** Вам может потребоваться выполнить команду с `sudo`:
    ```bash
    sudo ln -s "$(pwd)/.venv/bin/my_aider" /usr/local/bin/my_aider
    ```
    **Если вы получили ошибку `File exists`:** Это значит, что ссылка или файл с таким именем уже существует. Вы можете либо удалить существующий файл/ссылку (`sudo rm /usr/local/bin/my_aider`), либо использовать флаг `-f` (force) для перезаписи:
    ```bash
    sudo ln -sf "$(pwd)/.venv/bin/my_aider" /usr/local/bin/my_aider
    ```

4.  **Обновите кэш команд оболочки (для zsh и некоторых других):**
    Чтобы оболочка немедленно распознала новую команду, выполните:
    ```bash
    rehash
    ```

Теперь вы должны иметь возможность вызывать `my_aider` из любого терминала.

**Примечание:** Использование имени `my_aider` как для исполняемого файла, так и для ссылки, помогает избежать конфликтов с оригинальным `aider`, если он также установлен (например, через `pip install aider`).

*   **Windows:**
    В Windows создание символических ссылок таким образом менее распространено. Вместо этого рекомендуется добавить директорию со скриптами вашего виртуального окружения (`.venv\Scripts`) в системную переменную `PATH`.

    1.  **Найдите путь к директории `Scripts`:** В корне вашего проекта `my_aider` это будет путь вроде `C:\путь\к\вашему\проекту\my_aider\.venv\Scripts`. Скопируйте этот полный путь.
    2.  **Добавьте путь в `PATH`:**
        *   Нажмите `Win + R`, введите `sysdm.cpl` и нажмите Enter.
        *   Перейдите на вкладку "Дополнительно" и нажмите кнопку "Переменные среды...".
        *   В разделе "Системные переменные" (или "Переменные среды пользователя", если вы хотите установить только для себя) найдите переменную `Path` и нажмите "Изменить...".
        *   Нажмите "Создать" и вставьте скопированный путь к директории `.venv\Scripts`.
        *   Нажмите "ОК" во всех открытых окнах.
    3.  **Перезапустите терминал:** Откройте новое окно командной строки или PowerShell. Теперь вы должны иметь возможность вызывать `my_aider` из любого места.

## Получение обновлений из оригинального Aider (upstream)

Ваш репозиторий (`origin`) связан с оригинальным репозиторием Aider (`upstream`), что позволяет вам получать последние обновления из него.

1.  **Загрузите последние изменения из `upstream`:**
    Эта команда скачивает все новые коммиты и ветки из оригинального репозитория, но не применяет их к вашей локальной ветке.
    ```bash
    git fetch upstream
    ```

2.  **Слейте изменения в вашу локальную ветку:**
    Переключитесь на вашу основную ветку (обычно `main`) и примените скачанные изменения из главной ветки `upstream` (обычно `main` или `master`).
    ```bash
    git checkout main
    git merge upstream/main
    ```
    *(Замените `upstream/main` на `upstream/master`, если главная ветка в оригинальном репозитории называется `master`)*

    **Внимание:** Во время слияния могут возникнуть *конфликты*, если вы изменяли те же части кода, что и в оригинальном репозитории. Git сообщит об этом, и вам нужно будет вручную разрешить конфликты в файлах, а затем завершить слияние (`git add <файлы_с_конфликтами>` и `git commit`).

3.  **Альтернативный способ (fetch + merge):**
    Команда `pull` объединяет шаги 1 и 2:
    ```bash
    git checkout main
    git pull upstream main
    ```
    *(Опять же, замените `main` на `master` при необходимости)*

После выполнения этих шагов ваша локальная ветка `main` будет содержать как ваши собственные изменения, так и последние обновления из оригинального репозитория Aider. Не забудьте отправить обновленную ветку в ваш репозиторий `origin`:
```bash
git push origin main
```
