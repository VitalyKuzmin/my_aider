# my_aider

Это форк проекта Aider с пользовательскими модификациями.

## Установка

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/VitalyKuzmin/my_aider.git
    cd my_aider
    ```

2.  **Создайте и активируйте виртуальное окружение:**
    *   **macOS/Linux:**
        ```bash
        python3.11 -m venv venv
        source venv/bin/activate
        ```
    *   **Windows:**
        ```bash
        python -m venv venv
        \venv\Scripts\activate
        ```
    *(Используйте `python` или `python3` в зависимости от вашей системы)*

3.  **Установите пакет в режиме редактирования:**
    Этот шаг установит все необходимые зависимости (указанные в `pyproject.toml` или `setup.py`, которые должны включать `requirements.txt`) и сделает команду `aider` доступной *внутри активированного виртуального окружения*.
    ```bash
    pip install -e .
    ```
    *(Возможно, потребуется `pip3` вместо `pip`)*
    После этого шага вы можете запускать `my_aider` из командной строки, пока активно ваше виртуальное окружение (`source venv/bin/activate`).
4. **Запустите:**
    ```bash
    python -m aider.main
    ```


## Глобальная установка с помощью pipx (Рекомендуется для macOS, Linux и Windows)

`pipx` — это кроссплатформенный инструмент для установки и запуска Python-приложений в изолированных окружениях. Он работает в macOS, Linux и Windows. Это рекомендуемый способ сделать `my_aider` доступным глобально без конфликтов с другими пакетами.

**Важно:** Этот проект требует **Python 3.11**. Убедитесь, что Python 3.11 установлен и доступен в вашей системе.
*   **macOS:** Вы можете установить его, например, с помощью Homebrew: `brew install python@3.11`.
*   **Windows:** Вы можете скачать установщик с [официального сайта Python](https://www.python.org/downloads/windows/) или установить через Microsoft Store. Убедитесь, что Python 3.11 добавлен в ваш системный PATH во время установки.

1.  **Установите pipx** (если он еще не установлен):
    Следуйте [официальной инструкции по установке pipx](https://pipx.pypa.io/stable/installation/). Обычно это делается командой:
    ```bash
    python3 -m pip install --user pipx
    python3 -m pipx ensurepath
    ```
    *(Возможно, потребуется перезапустить терминал после `ensurepath`)*

2.  **Установите `my_aider` с помощью pipx, указав Python 3.11:**
    Эта команда установит последнюю версию из ветки `main` вашего репозитория `origin`, используя Python 3.11 для создания изолированного окружения. `pipx` добавит команду `my_aider` в ваш PATH.
    ```bash
    pipx install --python python3.11 git+https://github.com/VitalyKuzmin/my_aider.git
    ```
    *   **Указание Python 3.11:**
        *   **macOS/Linux:** Если `python3.11` не находится в вашем PATH, замените `python3.11` на полный путь к исполняемому файлу (например, `/opt/homebrew/bin/python3.11` или результат `which python3.11`).
        *   **Windows:** Если `python3.11` не распознается, вам может потребоваться указать полный путь к `python.exe` для версии 3.11 (например, `C:\Users\ИмяПользователя\AppData\Local\Programs\Python\Python311\python.exe`) или использовать `py -3.11` вместо `python3.11`, если у вас установлен Python Launcher для Windows:
          ```bash
          pipx install --python "C:\путь\к\Python311\python.exe" git+https://github.com/VitalyKuzmin/my_aider.git
          # или, если установлен Python Launcher:
          pipx install --python py -3.11 git+https://github.com/VitalyKuzmin/my_aider.git
          ```
    *   **Принудительная установка/обновление:** Если `pipx` сообщает, что пакет `my-aider-chat` уже установлен (`'my-aider-chat' already seems to be installed`), используйте флаг `--force`:
        ```bash
        pipx install --force --python python3.11 git+https://github.com/VitalyKuzmin/my_aider.git
        ```
    *   **Возможное предупреждение:** Если вы ранее устанавливали пакет локально с помощью `pip install -e .` в `.venv`, `pipx` может выдать предупреждение вида `Note: my_aider was already on your PATH at .../.venv/bin/my_aider`. Это нормально и не является ошибкой. Это просто означает, что у вас есть две версии команды: глобальная (установленная `pipx`) и локальная (в `.venv`). Какая из них будет запускаться по умолчанию, зависит от того, активно ли ваше локальное окружение `.venv`.

3.  **Обновление:**
    Для обновления до последней версии из репозитория:
    ```bash
    pipx upgrade my_aider
    ```

4.  **Удаление:**
    ```bash
    pipx uninstall my_aider
    ```

## Создание глобального доступа вручную (Альтернативный метод, macOS/Linux)

Если вы хотите запускать вашу модифицированную версию `aider` из любого места без необходимости каждый раз активировать виртуальное окружение (`source .venv/bin/activate`), вы можете создать символическую ссылку на исполняемый файл `aider` (или `my_aider`, в зависимости от того, как он называется в `.venv/bin`) из директории, которая уже есть в вашем системном `PATH`. Стандартное место для пользовательских скриптов в macOS/Linux - это `/usr/local/bin`.

1.  **Убедитесь, что `/usr/local/bin` существует и находится в вашем `PATH`:**
    *   Проверить `PATH`: `echo $PATH`
    *   Если `/usr/local/bin` нет, его может потребоваться создать (`sudo mkdir -p /usr/local/bin`) и добавить в `PATH` (обычно через конфигурационные файлы вашей оболочки, например, `~/.zshrc` или `~/.bash_profile`).

2.  **Найдите имя исполняемого файла:**
    Перейдите в корневую директорию вашего проекта `my_aider` и проверьте содержимое папки `.venv/bin`:
    ```bash
    ls .venv/bin
    ```
    Найдите исполняемый файл, который запускает вашу версию aider. После `pip install -e .` он должен называться `my_aider` (согласно `pyproject.toml`).

3.  **Создайте символическую ссылку:**
    Выполните эту команду из корневой директории вашего проекта `my_aider` (где находится папка `.venv`), используя имя `my_aider` для файла в `.venv/bin`:
    ```bash
    ln -s "$(pwd)/.venv/bin/my_aider" /usr/local/bin/my_aider
    ```
    *   `"$(pwd)/.venv/bin/my_aider"`: Получает полный путь к исполняемому файлу `my_aider` внутри вашего виртуального окружения.
    *   `/usr/local/bin/my_aider`: Создает ссылку с именем `my_aider` в `/usr/local/bin`.

    **Если вы получили ошибку `Permission denied`:** Вам может потребоваться выполнить команду с `sudo`:
    ```bash
    sudo ln -s "$(pwd)/.venv/bin/my_aider" /usr/local/bin/my_aider
    ```
    **Если вы получили ошибку `File exists`:** Это значит, что ссылка или файл с таким именем уже существует. Вы можете либо удалить существующий файл/ссылку (`sudo rm /usr/local/bin/my_aider`), либо использовать флаг `-f` (force) для перезаписи:
    ```bash
    sudo ln -sf "$(pwd)/.venv/bin/my_aider" /usr/local/bin/my_aider
    ```

4.  **Обновите кэш команд оболочки (для zsh и некоторых других):**
    Чтобы оболочка немедленно распознала новую команду, выполните:
    ```bash
    rehash
    ```

Теперь вы должны иметь возможность вызывать `my_aider` из любого терминала.

**Примечание:** Использование имени `my_aider` как для исполняемого файла, так и для ссылки, помогает избежать конфликтов с оригинальным `aider`, если он также установлен (например, через `pip install aider`).

*   **Windows:**
    В Windows создание символических ссылок таким образом менее распространено. Вместо этого рекомендуется добавить директорию со скриптами вашего виртуального окружения (`.venv\Scripts`) в системную переменную `PATH`.

    1.  **Найдите путь к директории `Scripts`:** В корне вашего проекта `my_aider` это будет путь вроде `C:\путь\к\вашему\проекту\my_aider\.venv\Scripts`. Скопируйте этот полный путь.
    2.  **Добавьте путь в `PATH`:**
        *   Нажмите `Win + R`, введите `sysdm.cpl` и нажмите Enter.
        *   Перейдите на вкладку "Дополнительно" и нажмите кнопку "Переменные среды...".
        *   В разделе "Системные переменные" (или "Переменные среды пользователя", если вы хотите установить только для себя) найдите переменную `Path` и нажмите "Изменить...".
        *   Нажмите "Создать" и вставьте скопированный путь к директории `.venv\Scripts`.
        *   Нажмите "ОК" во всех открытых окнах.
    3.  **Перезапустите терминал:** Откройте новое окно командной строки или PowerShell. Теперь вы должны иметь возможность вызывать `my_aider` из любого места.

## Получение обновлений из оригинального Aider (upstream)

Ваш репозиторий (`origin`) связан с оригинальным репозиторием Aider (`upstream`), что позволяет вам получать последние обновления из него.

1.  **Загрузите последние изменения из `upstream`:**
    Эта команда скачивает все новые коммиты и ветки из оригинального репозитория, но не применяет их к вашей локальной ветке.
    ```bash
    git fetch upstream
    ```

2.  **Слейте изменения в вашу локальную ветку:**
    Переключитесь на вашу основную ветку (обычно `main`) и примените скачанные изменения из главной ветки `upstream` (обычно `main` или `master`).
    ```bash
    git checkout main
    git merge upstream/main
    ```
    *(Замените `upstream/main` на `upstream/master`, если главная ветка в оригинальном репозитории называется `master`)*

    **Внимание:** Во время слияния могут возникнуть *конфликты*, если вы изменяли те же части кода, что и в оригинальном репозитории. Git сообщит об этом, и вам нужно будет вручную разрешить конфликты в файлах, а затем завершить слияние (`git add <файлы_с_конфликтами>` и `git commit`).

3.  **Альтернативный способ (fetch + merge):**
    Команда `pull` объединяет шаги 1 и 2:
    ```bash
    git checkout main
    git pull upstream main
    ```
    *(Опять же, замените `main` на `master` при необходимости)*

После выполнения этих шагов ваша локальная ветка `main` будет содержать как ваши собственные изменения, так и последние обновления из оригинального репозитория Aider. Не забудьте отправить обновленную ветку в ваш репозиторий `origin`:
```bash
git push origin main
```



**Assistant**:

Похоже, что функциональность поиска в Интернете в основном реализована через команды `/web` и `/browse` в файле `aider/commands.py`. Эти команды выполняют поиск или скрапинг веб-страницы с помощью классов `Scraper` или `Browser`, а затем добавляют полученный контент в историю чата как сообщение от пользователя.

В предоставленных файлах (`aider/io.py` и `aider/commands.py`) я не вижу явных инструкций для LLM о том, *как именно* выполнять поиск в Google. LLM, скорее всего, узнает о возможности использования этих команд из их описаний или из системных промптов.

Инструкции, описывающие инструменты и их использование для LLM, часто находятся в системных промптах или в описаниях функций (tools), передаваемых модели. Вероятно, инструкции по поиску находятся в файле, отвечающем за промпты.

Не могли бы вы добавить файл `aider/coders/base_prompts.py` в чат? Я проверю его на наличие инструкций, связанных с поиском в Интернете, и предложу, как их можно закомментировать.


---

**Assistant**:

Я изучил файл `aider/coders/base_prompts.py`. В нем содержатся общие шаблоны промптов, но я не нашел явных инструкций, которые говорили бы LLM, *как* использовать команды `/web` или `/browse` для поиска в Google.

Скорее всего, LLM узнает об этих командах одним из следующих способов:

1.  Из списка доступных команд, который передается ему (возможно, как часть системного промпта или описания инструментов/функций).
2.  Из описаний команд (docstrings) в файле `aider/commands.py`, особенно если используется механизм вызова функций (function calling/tool use).
3.  Из вывода команды `/help`, если LLM его запрашивает или он включен в контекст.

Поэтому простое комментирование строк в `aider/coders/base_prompts.py` вряд ли отключит использование этих команд.

Более надежный способ — изменить сами команды в файле `aider/commands.py`, чтобы они либо ничего не делали, либо сообщали об ошибке.